// File: android/app/build.gradle

// --- DÉBUT DES CORRECTIONS ---

// 1. Remplacez toutes les lignes 'apply plugin' et 'apply from' par le bloc 'plugins'
plugins {
    id 'com.android.application'
    id 'org.jetbrains.kotlin.android' // Nouvelle syntaxe pour kotlin-android
    
    // Ceci est la clé : utilise le plugin déclaré dans settings.gradle
    id 'dev.flutter.flutter-gradle-plugin' 
}

// --- FIN DES CORRECTIONS ---


def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader('UTF-8') { reader ->
        localProperties.load(reader)
    }
}

// Load .env
def flutterDotEnv = rootProject.file(".env")
def envProperties = new Properties()
if (flutterDotEnv.exists()) {
    flutterDotEnv.withReader('UTF-8') { reader ->
        envProperties.load(reader)
    }
}

android {
    namespace "com.vinote.app"

    // La variable flutter.compileSdkVersion est maintenant disponible grâce au plugin
    compileSdk = flutter.compileSdkVersion

    defaultConfig {
        applicationId "com.vinote.app"

        versionCode rootProject.flutter.versionCode.toInteger()
        versionName rootProject.flutter.versionName.toString()
        
        // Ces lignes doivent rester avec le préfixe 'flutter.' pour l'extension :
        minSdk = flutter.minSdkVersion
        targetSdk = flutter.targetSdkVersion
        
    }

    compileOptions {
        // Pour une compatibilité maximale avec Android Studio et le SDK, Java 1.8 (alias VERSION_1_8)
        // est souvent le choix par défaut, mais Java 17 est correct si le reste de votre configuration suit.
        sourceCompatibility JavaVersion.VERSION_1_8 
        targetCompatibility JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = "1.8"
    }
    
    // ... (ndkVersion est géré par le plugin Flutter)
    ndkVersion flutter.ndkVersion
    
    aaptOptions {
        noCompress "tflite"
    }
}

flutter {
    source '../..'
}

dependencies {
    // Les dépendances sont correctes, le plugin Flutter les ajoute automatiquement
    implementation "com.google.android.material:material:1.11.0"
    implementation "androidx.appcompat:appcompat:1.6.1"
    
    // Utilisez 'implementation' pour la stdlib Kotlin
    implementation "org.jetbrains.kotlin:kotlin-stdlib:1.9.22" 

    implementation "org.tensorflow:tensorflow-lite-task-vision:0.4.0"
    implementation "org.tensorflow:tensorflow-lite-gpu:2.11.0"
}