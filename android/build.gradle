def flutterRoot = file('/home/studio/development/flutter')
def flutterBuildScript = new File(flutterRoot, '/packages/flutter_tools/gradle/flutter.gradle')

// Définition des propriétés de version
// Ces valeurs sont lues depuis votre pubspec.yaml par le plugin Flutter, 
// puis nous les injectons dans les variables globales (ext) du rootProject
def flutterProperties = new Properties()
file(flutterRoot.getParentFile(), '.pubspec').withReader('UTF-8') { reader ->
    flutterProperties.load(reader)
}

rootProject.ext {
    // Injecter les propriétés du pubspec.yaml pour les rendre accessibles
    flutterVersionCode = flutterProperties.getProperty('versionCode', '1').toInteger()
    flutterVersionName = flutterProperties.getProperty('versionName', '1.0.0').toString()
}
buildscript {
    ext.kotlin_version = '1.9.22'
    repositories {
        google()
        mavenCentral()
    }

    dependencies {
        classpath "com.android.tools.build:gradle:7.4.2"
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
    }
}

subprojects {
    afterEvaluate { project ->
        if (project.name == 'app') {
            android {
                // S'assurer que le compileSdkVersion est visible ici
                compileSdkVersion flutter.compileSdkVersion
            }
        }
    }
}

allprojects {
    repositories {
        google()
        mavenCentral()
        maven { url "https://storage.googleapis.com/download.flutter.io" }
    }
}
